import{u as I,r as C,a as u,d as k}from"./cart2.D96fcsPX.js";import{a as w}from"./utils.CdyNXDGi.js";import{f as b}from"./authentication.DqMf7FyG.js";async function B(){try{const t=w("/checkout-languages/active"),e=await b(t,{},3,8e3,!1);if(!e.ok)throw new Error(`API error: ${e.status}`);return(await e.json()).language}catch(t){return console.error("Error fetching active checkout language:",t),null}}async function L(t,e,o,s,n){if(!t||!t.trim())return console.error("validateDiscount: code is required."),null;try{const a=new URLSearchParams({code:t});e!==void 0&&a.append("total",String(e)),s!==void 0&&a.append("shippingCost",String(s)),n&&a.append("customerPhone",n),o&&o.length>0&&a.append("items",JSON.stringify(o));const r=w(`/discounts/validate?${a.toString()}`),i=await b(r,{},2,8e3,!1);return i.ok?await i.json():await i.json()}catch(a){return console.error(`Error validating discount code "${t}":`,a),{valid:!1,error:"An unexpected error occurred while validating the discount."}}}let p=null,h=!1;const D=null;async function y(){if(p)return p;try{const e=await B();if(e)return p=e,p}catch(e){console.error("Error fetching checkout language:",e)}const t={id:"fallback",name:"English (Fallback)",code:"en",languageData:{pageTitle:"Cart & Checkout",checkoutSectionTitle:"Checkout Information",cartSectionTitle:"Shopping Cart",customerNameLabel:"Full Name",customerNamePlaceholder:"Enter your full name",customerPhoneLabel:"Phone Number",customerPhonePlaceholder:"01XXXXXXXXX",customerPhoneHelp:"Example: 01712345678",customerEmailLabel:"Email (Optional)",customerEmailPlaceholder:"Enter your email address",shippingAddressLabel:"Delivery Address",shippingAddressPlaceholder:"Enter your full delivery address",cityLabel:"City",zoneLabel:"Zone",areaLabel:"Area (Optional)",shippingMethodLabel:"Choose Delivery Option",orderNotesLabel:"Order Notes (Optional)",orderNotesPlaceholder:"Any special instructions for your order?",continueShoppingText:"Continue Shopping",subtotalText:"Subtotal",shippingText:"Shipping",discountText:"Discount",totalText:"Total",discountCodePlaceholder:"Discount code",applyDiscountText:"Apply",removeDiscountText:"Remove",placeOrderText:"Place Order",processingText:"Processing...",emptyCartText:"Your cart is empty",termsText:"By placing this order, you agree to our Terms of Service and Privacy Policy",processingOrderTitle:"Processing Your Order",processingOrderMessage:"Please wait while we process your order.",requiredFieldIndicator:"*"},fieldVisibility:{showEmailField:!0,showOrderNotesField:!0,showAreaField:!0},isActive:!0,isDefault:!0};return p=t,t}function d(t,e){const o=document.getElementById("discountMessage");if(!o)return;o.textContent=t;const s={success:"text-green-600",error:"text-red-600",info:"text-blue-600"};o.className=`text-xs mt-1 ${s[e]}`,o.style.display="block",setTimeout(()=>{o&&(o.style.display="none")},4e3)}function P(){const{discount:t}=u.get(),e=document.getElementById("discountCodeInput"),o=document.getElementById("applyDiscountBtn"),s=document.getElementById("removeDiscountBtn"),n=document.getElementById("discountRow"),a=document.getElementById("discountAmount"),r=document.getElementById("appliedDiscountCode");!e||!o||!s||!n||!a||!r||(t?(e.value=t.code,e.disabled=!0,o.style.display="none",s.style.display="block",n.style.display="flex",a.textContent=`-৳${(t.discountAmount||0).toLocaleString()}`,r.textContent=t.code,r.parentElement.classList.remove("hidden")):(e.value="",e.disabled=!1,o.style.display="block",s.style.display="none",n.style.display="none"))}async function g(){const{totalAmount:t,discount:e}=u.get(),o=window.lastShippingEventDetail?.fee??0,s=document.getElementById("subtotal"),n=document.getElementById("shippingCost"),a=document.getElementById("total"),r=document.getElementById("discountCodeHidden");if(!s||!n||!a||!r)return;s.textContent=`৳${t.toLocaleString()}`,n.textContent=`৳${o.toLocaleString()}`;let i=t+o;e&&e.discountAmount?(i-=e.discountAmount,r.value=JSON.stringify({id:e.id,code:e.code,type:e.type,amount:e.discountAmount})):r.value="",a.textContent=`৳${Math.max(0,i).toLocaleString()}`,P()}async function v(){const t=await y(),e=document.getElementById("cartItems"),o=document.getElementById("cartItemsInput");if(!e||!o)return;const{items:s}=u.get();if(o.value=Object.keys(s).length>0?JSON.stringify(s):"{}",Object.keys(s).length===0){e.innerHTML=`
        <div class="text-center py-8 px-4">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
          <h3 class="mt-2 text-lg font-medium text-gray-900">${t.languageData.emptyCartText}</h3>
          <p class="mt-1 text-sm text-gray-500">Looks like you haven't added anything to your cart yet.</p>
          <div class="mt-6"><a href="/" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800"><svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" /></svg>${t.languageData.continueShoppingText}</a></div>
        </div>`;return}e.innerHTML=Object.values(s).map(n=>`
        <div class="py-2.5 sm:py-3 first:pt-0"><div class="flex gap-2.5 sm:gap-3">
            <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0"><img src="${n?.image||"/placeholder.jpg"}" alt="${n.name}" class="object-cover" /></div>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between">
                <div class="min-w-0"><h3 class="font-medium truncate text-sm sm:text-base">${n.name}</h3><div class="text-xs sm:text-sm text-gray-500 mt-0.5 sm:mt-1">${n.size||n.color?`<div class="space-x-1">${n.size?`<span>Size: ${n.size}</span>`:""}${n.size&&n.color?"<span>•</span>":""}${n.color?`<span>Color: ${n.color}</span>`:""}</div>`:""}</div></div>
                <button class="text-gray-400 hover:text-red-600 transition-colors ml-1.5 sm:ml-2 p-0.5" onclick="window.removeFromCart('${n.id}', '${n.variantId||""}')"><svg class="w-4 h-4 sm:w-5 sm:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6 18L18 6M6 6l12 12" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
              </div>
              <div class="flex items-center justify-between mt-1.5 sm:mt-2">
                <div class="flex items-center gap-1.5 sm:gap-2">
                  <button class="w-6 h-6 sm:w-7 sm:h-7 rounded-md sm:rounded-lg ring-1 sm:ring-2 ring-black/10 flex items-center justify-center hover:bg-gray-100 text-xs sm:text-sm" onclick="window.updateCartQuantity('${n.id}', '${n.variantId||""}', ${Math.max(0,n.quantity-1)})">-</button>
                  <span class="w-5 sm:w-6 text-center text-xs sm:text-sm">${n.quantity}</span>
                  <button class="w-6 h-6 sm:w-7 sm:h-7 rounded-md sm:rounded-lg ring-1 sm:ring-2 ring-black/10 flex items-center justify-center hover:bg-gray-100 text-xs sm:text-sm" onclick="window.updateCartQuantity('${n.id}', '${n.variantId||""}', ${n.quantity+1})">+</button>
                </div>
                <div class="text-right"><div class="font-medium text-sm sm:text-base">৳${(n.price*n.quantity).toLocaleString()}</div><div class="text-xs text-gray-500">৳${n.price.toLocaleString()} each</div></div>
              </div>
            </div>
          </div></div>`).join(""),await g()}function f(){const t=document.getElementById("submitButton");if(!t)return;const e=Object.keys(u.get().items).length===0;t.disabled=e,t.classList.toggle("opacity-50",e),t.classList.toggle("cursor-not-allowed",e),t.title=e?"Your cart is empty":""}function x(){if(h)return;const{items:t,totalAmount:e}=u.get(),s=document.getElementById("customerPhone")?.value,n=s&&/^01[3-9]\d{8}$/.test(s.replace(/^\+?88/,""));Object.keys(t).length>0&&n&&(D({content_ids:Object.values(t).map(a=>a.variantId||a.id),contents:Object.values(t).map(a=>({id:a.variantId||a.id,quantity:a.quantity,item_price:a.price})),currency:"BDT",num_items:Object.values(t).reduce((a,r)=>a+r.quantity,0),value:e}),h=!0,console.log("CAPI: InitiateCheckout event tracked."))}async function S(){const t=await y(),o=document.getElementById("discountCodeInput").value.trim();if(!o){d("Please enter a discount code","error");return}const{items:s,totalAmount:n,discount:a}=u.get();if(Object.keys(s).length===0){d(t.languageData.emptyCartText,"error");return}if(a){d("Please remove the current discount first.","error");return}const r=document.getElementById("customerPhone"),i=r?.value;if(!i||!/^01[3-9]\d{8}$/.test(i.replace(/^\+?88/,""))){d("Please enter a valid phone number before applying a discount.","info"),r.focus();return}const c=document.getElementById("applyDiscountBtn");c.textContent=t.languageData.processingText,c.disabled=!0;try{const m=window.lastShippingEventDetail?.fee??0,l=await L(o,n,Object.values(s),m,i);l?.valid&&l.discount&&l.discountAmount!==void 0?(k({...l.discount,discountAmount:l.discountAmount}),d("Discount applied successfully!","success")):d(l?.error||"Invalid discount code","error")}catch(m){console.error("Error applying discount:",m),d("Failed to apply discount. Please try again.","error")}finally{c.textContent=t.languageData.applyDiscountText,c.disabled=!1}}function T(){removeDiscount(),d("Discount removed.","success")}async function $(){window.updateCartQuantity=(t,e,o)=>I(t,e||void 0,o),window.removeFromCart=(t,e)=>C(t,e||void 0),u.subscribe(()=>{v(),g(),f()}),window.addEventListener("shippingLocationChange",t=>{window.lastShippingEventDetail=t.detail,g()}),document.addEventListener("zone-selected",()=>{x()}),document.getElementById("discountForm")?.addEventListener("submit",t=>{t.preventDefault(),S()}),document.getElementById("customerPhone")?.addEventListener("blur",()=>{x()}),document.getElementById("removeDiscountBtn")?.addEventListener("click",T),await y(),await v(),g(),f()}$();document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("checkoutForm"),e=document.getElementById("submitButton"),o=document.getElementById("loadingOverlay"),s=document.getElementById("loadingProgressBar"),n=()=>{const r=document.getElementById("cartItemsInput");return!r||!r.value||r.value==="{}"||r.value==="[]"},a=()=>{if(e){const r=n();e.disabled=r,e.title=r?"Your cart is empty. Please add items to your cart before placing an order.":"",r?e.classList.add("opacity-50","cursor-not-allowed"):e.classList.remove("opacity-50","cursor-not-allowed")}};a(),window.addEventListener("cart-updated",a),t&&e&&o&&s&&t.addEventListener("submit",r=>{if(n())return r.preventDefault(),alert("Your cart is empty. Please add items to your cart before placing an order."),!1;const i=["customerName","customerPhone","shippingAddress","shippingLocation","city","zone"];let c=[];for(const m of i){const l=document.querySelector(`[name="${m}"]`);(!l||!l.value)&&c.push(m)}return c.length>0?(r.preventDefault(),alert(`Please fill in all required fields: ${c.join(", ")}`),!1):(e.disabled=!0,e.textContent="Processing...",o.style.display="block",document.body.style.overflow="hidden",window.scrollTo(0,0),s.style.width="0%",setTimeout(()=>{s.style.width="30%"},300),setTimeout(()=>{s.style.width="60%"},1e3),setTimeout(()=>{s.style.width="80%"},2e3),!0)})});function E(){const t=document.getElementById("customerPhone"),e=document.getElementById("customerEmail"),o=(a,r)=>{if(!r||!r.trim()){sessionStorage.removeItem(a);return}try{sessionStorage.setItem(a,r.trim())}catch(i){console.warn("Could not save to sessionStorage:",i)}};t&&t.addEventListener("change",()=>{o("scalius_user_phone",t.value)}),e&&e.addEventListener("change",()=>{o("scalius_user_email",e.value)});const s=sessionStorage.getItem("scalius_user_phone");s&&t&&(t.value=s);const n=sessionStorage.getItem("scalius_user_email");n&&e&&(e.value=n)}document.addEventListener("DOMContentLoaded",E);document.addEventListener("astro:page-load",E);
