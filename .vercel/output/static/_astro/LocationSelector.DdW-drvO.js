import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.C7R7J_0t.js";import{L as S}from"./label.CnG6lw6_.js";import{a as $}from"./utils.CdyNXDGi.js";import{f as z}from"./authentication.DqMf7FyG.js";import"./index.DfT8ewGw.js";import"./index.DH4MlOaT.js";function E({options:o,placeholder:c,value:n,onChange:f,name:j,id:g,disabled:p=!1,required:b=!1,className:y=""}){const[l,d]=a.useState(!1),[h,i]=a.useState(""),w=a.useRef(null),u=a.useRef(null),x=o.find(r=>r.value===n),s=o.filter(r=>r.label.toLowerCase().includes(h.toLowerCase()));a.useEffect(()=>{function r(L){w.current&&!w.current.contains(L.target)&&(d(!1),i(""))}return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),a.useEffect(()=>{l&&u.current&&setTimeout(()=>{u.current?.focus()},100)},[l]);const v=()=>{p||(d(!l),i(""))},N=r=>{f(r.value),d(!1),i("")},k=r=>{i(r.target.value)},C=r=>{l&&(r.key==="Escape"?(d(!1),i("")):r.key==="Enter"&&s.length>0&&N(s[0]))};return e.jsxs("div",{ref:w,className:`relative w-full ${y}`,children:[e.jsx("input",{type:"hidden",name:j,value:n,required:b}),e.jsxs("button",{type:"button",id:g,className:`flex items-center justify-between w-full px-2.5 py-1.5 text-left bg-white border rounded-md h-8 sm:h-9 text-xs sm:text-sm ${p?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-50"}`,onClick:v,disabled:p,"aria-haspopup":"listbox","aria-expanded":l,children:[e.jsx("span",{className:`block truncate ${x?"":"text-gray-400"}`,children:x?x.label:c}),e.jsx("span",{className:"ml-2 pointer-events-none",children:e.jsx("svg",{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 transition-transform ${l?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),l&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg overflow-hidden",role:"listbox",onKeyDown:C,children:[e.jsx("div",{className:"sticky top-0 p-1.5 bg-white border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:u,type:"text",className:"w-full px-2 py-1 border rounded-md text-xs sm:text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 h-8 sm:h-9",placeholder:`Search ${c.toLowerCase()}`,value:h,onChange:k,onClick:r=>r.stopPropagation()}),h&&e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 p-0.5",onClick:()=>i(""),children:e.jsx("svg",{className:"w-3 h-3 sm:w-3.5 sm:h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"overflow-auto max-h-[200px] sm:max-h-[240px]",children:e.jsx("ul",{className:"py-1",children:s.length>0?s.map(r=>e.jsx("li",{className:`px-2.5 py-1 cursor-pointer hover:bg-gray-100 text-xs sm:text-sm ${r.value===n?"bg-gray-100 font-medium":""}`,onClick:()=>N(r),role:"option","aria-selected":r.value===n,children:r.label},r.value)):e.jsx("li",{className:"px-2.5 py-1.5 text-gray-500 text-center text-xs sm:text-sm",children:"No options found"})})})]})]})}function _({options:o,placeholder:c,value:n,onChange:f,name:j,id:g,disabled:p=!1,required:b=!1,className:y=""}){const[l,d]=a.useState(!1),h=a.useRef(null),i=o.find(s=>s.value===n);a.useEffect(()=>{function s(v){h.current&&!h.current.contains(v.target)&&d(!1)}return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]);const w=()=>{p||d(!l)},u=s=>{f(s.value),d(!1)},x=s=>{l&&(s.key==="Escape"?d(!1):s.key==="Enter"&&o.length>0&&u(o[0]))};return e.jsxs("div",{ref:h,className:`relative w-full ${y}`,children:[e.jsx("input",{type:"hidden",name:j,value:n,required:b}),e.jsxs("button",{type:"button",id:g,className:`flex items-center justify-between w-full px-2.5 py-1.5 text-left bg-white border rounded-md h-8 sm:h-9 text-xs sm:text-sm ${p?"opacity-50 cursor-not-allowed":"cursor-pointer hover:bg-gray-50"}`,onClick:w,disabled:p,"aria-haspopup":"listbox","aria-expanded":l,children:[e.jsx("span",{className:`block truncate ${i?"":"text-gray-400"}`,children:i?i.label:c}),e.jsx("span",{className:"ml-2 pointer-events-none",children:e.jsx("svg",{className:`w-3.5 h-3.5 sm:w-4 sm:h-4 transition-transform ${l?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),l&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg overflow-auto max-h-[160px] sm:max-h-[180px]",role:"listbox",onKeyDown:x,children:e.jsx("ul",{className:"py-1",children:o.length>0?o.map(s=>e.jsx("li",{className:`px-2.5 py-1 cursor-pointer hover:bg-gray-100 text-xs sm:text-sm ${s.value===n?"bg-gray-100 font-medium":""}`,onClick:()=>u(s),role:"option","aria-selected":s.value===n,children:s.label},s.value)):e.jsx("li",{className:"px-2.5 py-1.5 text-gray-500 text-center text-xs sm:text-sm",children:"No options available"})})})]})}async function q(o){if(!o)return console.error("getZones: cityId is required."),null;try{const c=$(`/locations/zones?cityId=${o}`),n=await z(c,{},3,8e3,!1);if(!n.ok)throw new Error(`API error: ${n.status}`);return(await n.json()).data}catch(c){return console.error(`Error fetching zones for city "${o}":`,c),null}}async function K(o){if(!o)return console.error("getAreas: zoneId is required."),null;try{const c=$(`/locations/areas?zoneId=${o}`),n=await z(c,{},3,8e3,!1);if(!n.ok)throw new Error(`API error: ${n.status}`);return(await n.json()).data}catch(c){return console.error(`Error fetching areas for zone "${o}":`,c),null}}function G({cities:o,cityLabel:c="City",zoneLabel:n="Zone",areaLabel:f="Area (Optional)",showAreaField:j=!0}){const[g,p]=a.useState(""),[b,y]=a.useState(""),[l,d]=a.useState(""),[h,i]=a.useState([]),[w,u]=a.useState([]),[x,s]=a.useState(!1),[v,N]=a.useState(!1),k=async t=>{if(t){s(!0);try{const m=await q(t);i(m||[])}catch(m){console.error("Error loading zones:",m),i([])}finally{s(!1)}}},C=async t=>{if(t){N(!0);try{const m=await K(t);u(m||[])}catch(m){console.error("Error loading areas:",m),u([])}finally{N(!1)}}},r=t=>{p(t),y(""),d(""),i([]),u([]),k(t)},L=t=>{if(y(t),d(""),u([]),t){C(t);const m=h.find(I=>I.id===t),R=new CustomEvent("zone-selected",{detail:{zoneId:t,zoneName:m?.name||""}});window.dispatchEvent(R)}},A=t=>{d(t)},O=o.map(t=>({value:t.id,label:t.name})),Z=h.map(t=>({value:t.id,label:t.name})),D=w.map(t=>({value:t.id,label:t.name}));return e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(S,{htmlFor:"city",className:"mb-0.5 block text-xs sm:text-sm font-medium",children:[c," *"]}),e.jsx(E,{id:"city",name:"city",placeholder:"Select a city",options:O,value:g,onChange:r,required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(S,{htmlFor:"zone",className:"mb-0.5 block text-xs sm:text-sm font-medium",children:[n," *"]}),e.jsx(E,{id:"zone",name:"zone",placeholder:"Select a zone",options:Z,value:b,onChange:L,disabled:!g||x,required:!0}),x&&e.jsx("div",{className:"absolute right-2.5 top-[calc(50%-0.5rem+2px)] h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent motion-reduce:animate-[spin_1.5s_linear_infinite]",children:e.jsx("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})]}),j&&e.jsxs("div",{className:"relative",children:[e.jsx(S,{htmlFor:"area",className:"mb-0.5 block text-xs sm:text-sm font-medium",children:f}),e.jsx(_,{id:"area",name:"area",placeholder:"Select an area (optional)",options:D,value:l,onChange:A,disabled:!b||v,className:"z-10"}),v&&e.jsx("div",{className:"absolute right-2.5 top-[calc(50%-0.5rem+2px)] h-4 w-4 animate-spin rounded-full border-2 border-solid border-current border-r-transparent motion-reduce:animate-[spin_1.5s_linear_infinite]",children:e.jsx("span",{className:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]",children:"Loading..."})})]})]})}export{G as default};
