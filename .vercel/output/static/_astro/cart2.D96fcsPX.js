let l=[],c=0;const f=4;let m=t=>{let n=[],e={get(){return e.lc||e.listen(()=>{})(),e.value},lc:0,listen(s){return e.lc=n.push(s),()=>{for(let u=c+f;u<l.length;)l[u]===s?l.splice(u,f):u+=f;let o=n.indexOf(s);~o&&(n.splice(o,1),--e.lc||e.off())}},notify(s,o){let u=!l.length;for(let a of n)l.push(a,e.value,s,o);if(u){for(c=0;c<l.length;c+=f)l[c](l[c+1],l[c+2],l[c+3]);l.length=0}},off(){},set(s){let o=e.value;o!==s&&(e.value=s,e.notify(o))},subscribe(s){let o=e.listen(s);return s(e.value),o},value:t};return e},y=(t={})=>{let n=m(t);return n.setKey=function(e,s){let o=n.value;typeof s>"u"&&e in n.value?(n.value={...n.value},delete n.value[e],n.notify(o,e)):n.value[e]!==s&&(n.value={...n.value,[e]:s},n.notify(o,e))},n};const K=m(!1),p=typeof window<"u"?JSON.parse(localStorage.getItem("cart")||'{"items":{},"totalItems":0,"totalAmount":0,"discount":null}'):{items:{},totalItems:0,totalAmount:0,discount:null},i=y(p);typeof window<"u"&&i.subscribe(t=>{localStorage.setItem("cart",JSON.stringify(t))});function g(t){if(t.variantId&&t.variantId!=="default")return`${t.id}-${t.variantId}`;if(t.size||t.color){const n=t.size||"no-size",e=t.color||"no-color";return`${t.id}-${n}-${e}`}return t.id}function E(t){const n=i.get().items,e=g(t),s=n[e],o=t.quantity||1;s?i.setKey("items",{...n,[e]:{...s,quantity:s.quantity+o}}):i.setKey("items",{...n,[e]:{...t,quantity:o}}),r(),typeof document<"u"&&document.dispatchEvent(new CustomEvent("cart-updated"))}function v(t,n){const e=i.get().items;let s=t;if(n&&n!=="default"&&(s=`${t}-${n}`),!e[s]){const u=Object.keys(e).find(a=>a.startsWith(t)||a===t);u&&(s=u)}const o={...e};delete o[s],i.setKey("items",o),r()}function h(t,n,e){console.log(t,n,e);const s=i.get().items;let o=t;if(n&&n!=="default"&&(o=`${t}-${n}`),!s[o]){const a=Object.keys(s).find(d=>d.startsWith(t)||d===t);a&&(o=a)}const u=s[o];if(u){if(e<=0){v(t,n);return}i.setKey("items",{...s,[o]:{...u,quantity:e}}),r()}}function $(t){i.setKey("discount",t),r(),typeof document<"u"&&(document.dispatchEvent(new CustomEvent("discount-applied")),document.dispatchEvent(new CustomEvent("cart-updated")))}function b(){i.set({items:{},totalItems:0,totalAmount:0,discount:null})}function r(){const t=i.get(),n=Object.values(t.items),e=n.reduce((o,u)=>o+u.quantity,0),s=n.reduce((o,u)=>o+u.price*u.quantity,0);i.setKey("totalItems",e),i.setKey("totalAmount",s),e===0&&t.discount&&i.setKey("discount",null)}export{i as a,E as b,b as c,$ as d,K as i,v as r,h as u};
